
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Setting Up GCP Monitoring &#8212; Engineering Team Resource Book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Monitoring GCP Slack Alerts" href="gcp_monitoring_intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/openteams_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Engineering Team Resource Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Engineering Team Resource Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="instructions.html">
   Book Tutorial and Guidelines
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="developer_guidelines.html">
   OpenTeams Engineering Developer Guidelines
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="team_culture.html">
     Team Culture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="communication_standards.html">
     Communication Standards
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="engineering.html">
     Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="appendix.html">
     Appendix
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="otscore_intro.html">
   OpenTeams Score
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="otscore_components.html">
     Components of the OpenTeams Score
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="gcp_monitoring_intro.html">
   Monitoring GCP Slack Alerts
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Setting Up GCP Monitoring
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdocs/gcp_monitoring_steps.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/docs/gcp_monitoring_steps.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-a-notifications-channel">
   1. Setting Up a Notifications Channel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-an-alerting-policy">
   2. Creating an Alerting Policy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-the-alerts">
   3. Testing the Alerts
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Setting Up GCP Monitoring</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-a-notifications-channel">
   1. Setting Up a Notifications Channel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-an-alerting-policy">
   2. Creating an Alerting Policy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-the-alerts">
   3. Testing the Alerts
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="setting-up-gcp-monitoring">
<h1>Setting Up GCP Monitoring<a class="headerlink" href="#setting-up-gcp-monitoring" title="Permalink to this headline">#</a></h1>
<section id="setting-up-a-notifications-channel">
<h2>1. Setting Up a Notifications Channel<a class="headerlink" href="#setting-up-a-notifications-channel" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>In order to be able to set alert conditions, you must first set up a notifications channel for those alerts. Do this by going <a class="reference external" href="https://console.cloud.google.com/monitoring?_ga=2.154211320.1135228163.1672770768-27455422.1666893129">here</a> to monitoring, selecting a project, then clicking Alerting and then EDIT NOTIFICATION CHANNELS.</p></li>
<li><p>Under Slack, click Add New and allow access to your workspace. Make a channel in the Slack workspace for alerts. If it is a private channel, add the monitoring Slack app to it with <code class="docutils literal notranslate"><span class="pre">/invite</span> <span class="pre">&#64;Google</span> <span class="pre">Cloud</span> <span class="pre">Monitoring</span></code>.</p></li>
<li><p>Go back to the GCP console and finish setting up the channel by filling in the required description and adding the new Slack channel name. Once this is done, send the test notification to ensure that Slack and GCP have linked correctly and the notifications are appearing in the correct channel. Add an email under the Email section below Slack in the GCP as a backup.</p></li>
</ul>
</section>
<section id="creating-an-alerting-policy">
<h2>2. Creating an Alerting Policy<a class="headerlink" href="#creating-an-alerting-policy" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Now that we have a notification channel, we can create the alerting policy that uses it. There are two types of alerting policies, metrics and logs based alerting. Mertics based alerting monitors a metric like CPU usage, and sends an alert when it falls outside of whatever range you deem acceptable in the policy.  Logs based alerting sends an alert when a specific type of log/a log containing a specific message appears.</p></li>
<li><p>We will only cover setting up logs based alerting here, but if you want to set up a metrics-based alerting policy, the instructions to do so are <a class="reference external" href="https://cloud.google.com/monitoring/alerts/using-alerting-ui">here</a>.</p></li>
<li><p>To set up a logs based alerting policy, go to the <a class="reference external" href="https://console.cloud.google.com/logs?_ga=2.191922154.1135228163.1672770768-27455422.1666893129">Logs Explorer</a>. Here, you can test querying the logs, which is how you build the conditions for your alert. The documentation for building a query is <a class="reference external" href="https://cloud.google.com/logging/docs/view/logging-query-language">here</a>.</p></li>
<li><p>Once you have a query that gets the log type that you want to be alerted about, you can turn that into an alerting policy by clicking Create alert in the bar above the histogram. Give your policy a descriptive name and documentation (this documentation is what appears as the header to the slack notifications recieve).</p></li>
<li><p>Next, paste your query into the text box where you define which log entries to alert on.</p></li>
<li><p>Set your notification frequency/autoclose duration as desired, and then for who should be notified select your new Slack channel and your email as a backup.</p></li>
</ul>
</section>
<section id="testing-the-alerts">
<h2>3. Testing the Alerts<a class="headerlink" href="#testing-the-alerts" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>To test your policy, create a JSON request body from the example <a class="reference external" href="https://cloud.google.com/logging/docs/alerting/log-based-alerts#lba-test">here</a> that fulfils your alert policy conditions. For example, if I had a policy that alerted when an error log appeared in my project, I would replace the project ID as shown, and change the “severity” field to “ERROR”.  Upload this test log with the Try this method function in the log entries explorer <a class="reference external" href="https://cloud.google.com/logging/docs/reference/v2/rest/v2/entries/write">here</a>.</p></li>
<li><p>This log, if uploaded with the correct conditions, should trigger the Slack being sent. It will also open an ‘incident’ and email you, so even if your Slack integration is not set up correctly, you should be able to see if it worked.</p></li>
</ul>
<div class="admonition-note admonition">
<p class="admonition-title">Note</p>
<p>The minimum time between alerts is 5 minutes, and it’s automatically set to 1 day between alerts, so if you forget to change this or attempt to test a sending a notification less than 5 minutes after one was sent sucessfully, you will not recieve another Slack. This isn’t a bug on your end, it’s just one aspect of the GCP notifications. You can change the alert window by clicking the edit button next to Policy details and changing the Time Between Notifications.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="gcp_monitoring_intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Monitoring GCP Slack Alerts</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By OpenTeams Engineering Team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>